---
title: "Responses Function Calling"
description: "通过 Responses API 使用 Function Calling 与外部工具交互"
---

# Responses Function Calling

Responses API 支持 Function Calling，让模型调用你定义的函数来获取外部数据或执行操作。

```
POST /v1/responses
```

---

## 定义工具并调用

<CodeGroup>

```bash cURL
curl https://crazyrouter.com/v1/responses \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "gpt-4o",
    "input": "北京和上海今天的天气怎么样？",
    "tools": [
      {
        "type": "function",
        "name": "get_weather",
        "description": "获取指定城市的当前天气",
        "parameters": {
          "type": "object",
          "properties": {
            "city": {
              "type": "string",
              "description": "城市名称"
            }
          },
          "required": ["city"]
        }
      }
    ]
  }'
```

```python Python
from openai import OpenAI
import json

client = OpenAI(
    api_key="YOUR_API_KEY",
    base_url="https://crazyrouter.com/v1"
)

tools = [
    {
        "type": "function",
        "name": "get_weather",
        "description": "获取指定城市的当前天气",
        "parameters": {
            "type": "object",
            "properties": {
                "city": {
                    "type": "string",
                    "description": "城市名称"
                }
            },
            "required": ["city"]
        }
    }
]

# 第一次调用
response = client.responses.create(
    model="gpt-4o",
    input="北京和上海今天的天气怎么样？",
    tools=tools
)

# 检查是否有函数调用
function_calls = [
    item for item in response.output
    if item.type == "function_call"
]

if function_calls:
    # 构建函数结果
    tool_results = []
    for call in function_calls:
        args = json.loads(call.arguments)
        # 执行你的函数
        if args["city"] == "北京":
            result = {"temperature": 22, "condition": "晴", "humidity": 40}
        else:
            result = {"temperature": 26, "condition": "多云", "humidity": 65}

        tool_results.append({
            "type": "function_call_output",
            "call_id": call.call_id,
            "output": json.dumps(result, ensure_ascii=False)
        })

    # 第二次调用，传入函数结果
    final_response = client.responses.create(
        model="gpt-4o",
        input=[
            {"role": "user", "content": "北京和上海今天的天气怎么样？"},
            *[{"type": item.type, "id": item.id, "call_id": item.call_id,
               "name": item.name, "arguments": item.arguments}
              for item in function_calls],
            *tool_results
        ],
        tools=tools
    )

    print(final_response.output_text)
```

</CodeGroup>

---

## 函数调用响应

当模型决定调用函数时，响应中会包含 `function_call` 类型的输出：

```json
{
  "id": "resp_abc123",
  "object": "response",
  "output": [
    {
      "type": "function_call",
      "id": "fc_001",
      "call_id": "call_abc123",
      "name": "get_weather",
      "arguments": "{\"city\": \"北京\"}"
    },
    {
      "type": "function_call",
      "id": "fc_002",
      "call_id": "call_def456",
      "name": "get_weather",
      "arguments": "{\"city\": \"上海\"}"
    }
  ],
  "status": "incomplete"
}
```

---

## 返回函数结果

将函数执行结果通过 `function_call_output` 返回：

```json
{
  "model": "gpt-4o",
  "input": [
    {"role": "user", "content": "北京和上海今天的天气怎么样？"},
    {
      "type": "function_call",
      "call_id": "call_abc123",
      "name": "get_weather",
      "arguments": "{\"city\": \"北京\"}"
    },
    {
      "type": "function_call_output",
      "call_id": "call_abc123",
      "output": "{\"temperature\": 22, \"condition\": \"晴\"}"
    },
    {
      "type": "function_call",
      "call_id": "call_def456",
      "name": "get_weather",
      "arguments": "{\"city\": \"上海\"}"
    },
    {
      "type": "function_call_output",
      "call_id": "call_def456",
      "output": "{\"temperature\": 26, \"condition\": \"多云\"}"
    }
  ],
  "tools": [...]
}
```

---

## 流式 Function Calling

```python Python
stream = client.responses.create(
    model="gpt-4o",
    input="查询苹果公司的股价",
    tools=tools,
    stream=True
)

for event in stream:
    if event.type == "response.function_call_arguments.delta":
        print(event.delta, end="")
    elif event.type == "response.function_call_arguments.done":
        print("\n函数调用完成:", event.arguments)
    elif event.type == "response.output_text.delta":
        print(event.delta, end="")
```

<Note>
  Responses API 的 Function Calling 与 Chat Completions API 的主要区别在于：工具定义直接使用 `name` 和 `parameters` 字段，不需要嵌套在 `function` 对象中。
</Note>
